{
	"name": "DaRT_API_Query",
	"properties": {
		"folder": {
			"name": "DaRT"
		},
		"content": {
			"query": "/****************************************************************************\n\nDaRT query to retrieve case data and related information.\n\nThere are 3 columns where multiple rows per case are possible, i.e.\n\nSpecialism\nContactID\nGroundForAppeal\n\nIt could be best to split those out so we have 4 tables / queries instead\nof one flat table\n\n****************************************************************************/\n\nUSE ODW_HARMONISED_DB;\n\nWITH SAMPLE_CASES AS \n(\nSELECT      \n                    \n                    t1.CaseReference,\n                    t1.AppealRefNumber,\n                    t6.ApplicationType,\n                    t6.AppealTypeReason,\n                    t6.AppealTypeGroup,\n                    t6.AppealType,\n                    t12.ProcedureName,\n                    t1.validity,\n                    t5.ProcessingState,\n                    t6.LinkedAppeal,\n                    t21.LastPublishedDate,\n                    t7.LPACode,\n                    t7.LPAName,\n                    t6.Jurisdiction,\n                    t5.DevelopmentOrAllegation,\n                    t5.CaseProcess,\n                    t6.DevelopmentType,\n                    t5.AppealSourceIndicator,\n                    t5.Level,\n                    t8.Specialism, -- a case can have multiple specialisms so more then 1 row per case is OK here\n                    t9.SpecialCircumstance,\n                    t5.ProcedureAppellant,\n                    t6.AppealRecDate,\n                    t6.AppealStartDate,\n                    t1.ValidTo,\n                    t10.ValidityStatusDate,\n                    t5.CallInDate,\n                    t5.TargetDate,\n                    t5.StatementsDue,\n                    t5.ThirdPartyRepsDue,\n                    t5.FinalCommentsDue,\n                    t5.StatementOfCommonGroundDue,\n                    t5.ProofsDue,\n                    t11.ModifyDate,\n                    t12.LpaDecisionDate,\n                    t13.OutcomePublicSafety,\n                    t13.OutcomeAmenity,\n                    t13.IsActive as AdvertInPosition,\n                    t13.SignDescription as AdvertDescription,\n                    t5.LPAApplicationDate,\n                    t5.LPAApplicationReference,\n                    t14.ContactID, -- multiple contacts per case so more than 1 row per case here as well\n                    t14.Title,\n                    t14.Salutation,\n                    t14.FirstName,\n                    t14.LastName,\n                    t14.TypeOfInvolvement,\n                    t15.AddressLine1,\n                    t15.AddressLine2,\n                    t15.AddressTown,\n                    t15.PostCode,\n                    t15.Easting,\n                    t15.Northing,\n                    t5.InspectorNeedToEnterSite,\n                    t5.NumberOfResidences,\n                    t5.AreaOfSiteInHectares,\n                    t5.FloorSpaceInSquareMetres,\n                    t5.SiteGreenBelt,\n                    t5.HistoricBuildingGrantMade,\n                    t12.OwnershipPermission,\n                    t5.AgriculturalHolding,\n                    t16.GroundForAppeal, -- multiple grounds per case\n                    t16.GroundLetter,\n                    t16.GroundForAppealStartDate,\n                    t18.EventType,\n                    t17.EstPrepTime,\n                    t17.EstSitTime,\n                    t17.EstRepTime,\n                    t17.ChartStatus,\n                    t18.StartDateOfEvent,\n                    t18.StartTimeOfEvent,\n                    t18.EndDateOfEvent,\n                    t19.NotificationOfSV,\n                    t18.DateEventRequested,\n                    t17.ActualDuration\n\n                    \nFROM                casework_case_info_dim t1\n\nLEFT OUTER JOIN     casework_all_appeals_additional_data_dim t5\nON                  t1.AppealRefNumber = t5.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t5.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_all_appeals_dim t6\nON                  t1.AppealRefNumber = t6.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t6.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_local_planning_authority_dim t7\nON                  t6.LPAID = t7.LPAID\nAND                 t6.IsActive = 'Y'\nAND                 t7.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_specialism_dim t8\nON                  t1.AppealRefNumber = t8.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t8.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_special_circumstance_dim t9\nON                  t1.AppealRefNumber = t9.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t9.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_case_dates_dim t10\nON                  t1.AppealRefNumber = t10.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t10.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_specialist_modifications_dim t11\nON                  t1.AppealRefNumber = t11.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t11.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_picaso_dim t12\nON                  t1.AppealRefNumber = t12.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t12.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_advert_details_dim t13\nON                  t1.AppealRefNumber = t13.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t13.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_contact_information_dim t14\nON                  t1.AppealRefNumber = t14.CaseNumber\nAND                 t1.IsActive = 'Y'\nAND                 t14.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_nsip_project_info_internal_dim t15\nON                  t1.CaseReference = t15.CaseReference\nAND                 t1.IsActive = 'Y'\nAND                 t15.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_enforcement_grounds_dim t16\nON                  t1.AppealRefNumber = t16.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t16.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_event_dim t17\nON                  t1.AppealRefNumber = t17.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t17.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_event_fact t18\nON                  t17.EventID = t18.EventID\nAND                 t17.IsActive = 'Y'\nAND                 t18.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_specialist_environment_dim t19\nON                  t1.AppealRefNumber = t19.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t19.IsActive = 'Y'\n\nLEFT OUTER JOIN     casework_nsip_advice_dim t21 \nON                  t1.CaseReference = t21.CaseReference\nAND                 t1.IsActive = 'Y'\nAND                 t21.IsActive = 'Y'\n\nWHERE               t6.AppealRecDate > '2023-06-01'\n)\n\nSELECT COUNT(DISTINCT CaseReference)\nFROM SAMPLE_CASES\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "odw_harmonised_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}