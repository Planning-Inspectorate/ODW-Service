{
	"name": "mipins_vw_fact_absence_all",
	"properties": {
		"content": {
			"query": "-- IF NOT EXISTS ( SELECT  *\n--                 FROM    sys.schemas\n--                 WHERE   name = 'mipins' )\n--     EXEC('CREATE SCHEMA [mipins]');\n-- GO\n\n--CREATE VIEW FOR PERSONNEL SUB AREA--\n\n-- CREATE OR ALTER VIEW mipins.vw_mipins_hr_personnel_sub_area\n-- AS\n\n-- SELECT \n\n--     [absence_date]\n--     [absence_hours]\n--     [staff_number]\n--     [Work Schedule Rule]\n--     [Abs Type]\n--     [Sickness Group]\n--     [Attendance or Absence Type]\n--     [Leave]\n--     [Leave_ONS]\n--     [PS Group]\n--     [Personnel Area]\n--     [Personnel Subarea]\n--     [sickness_id]\n--     [sickness_length]\n--     [sickness_length_type]\n--   FROM [sap_hr].[vw_fact_absence_all]\n\n-- GO\n\nSELECT TOP (100)\n    T1.Hours AS AbsenceHours,\n    T1.EmployeeID AS StaffNumber,\n    T6.WorkScheduleRule,\n    T1.AbsenceType,\n    T1.SicknessGroup,\n    CASE \n        WHEN AbsenceType = 'Sickness' THEN 'Sickness'\n        WHEN AbsenceType LIKE '%Annual%' THEN 'Annual'\n        ElSE '0'\n    END AS AbsenceGroup,\n    -- [Leave],\n\t-- case datepart(dw, absence_date)\n\t-- \twhen 2 then ws.Mo/7.4\n\t-- \twhen 3 then ws.Tu/7.4\n\t-- \twhen 4 then ws.We/7.4\n\t-- \twhen 5 then ws.Th/7.4\n\t-- \twhen 6 then ws.Fr/7.4\n\t-- \telse null\n\t-- end as LeaveONS,\n    T5.Description PayBand,\n    T3.Description AS PersonnelArea,\n    T4.Description AS PersonnelSubArea,\n    T1.[AbsenceID] AS SicknessID,\n\tT1.[Days] as SicknessLength,\n    CASE \n        WHEN CAST([Days] AS FLOAT) > 20.0 then 'long-term'\n\t\tELSE 'short-term'\n    END AS SicknessLengthType\nFROM [odw_harmonised_db].[dbo].[hr_absence_dim] T1\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_record_fact] T2 ON T1.EmployeeID=T2.EmployeeID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_personnel_area_dim] T3 ON T3.PersonnelAreaID=T2.PersonnelAreaID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_personnel_sub_area_dim] T4 ON T4.PersonnelSubAreaID=T2.PersonnelSubAreaID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_payband_dim] T5 ON T5.PayBandID=T2.PayBandID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_work_schedule_dim] T6 ON T6.WorkScheduleID = T2.WorkScheduleID\n\n\nGO\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}