{
	"name": "mipins_vw_fact_absence_all",
	"properties": {
		"content": {
			"query": "IF NOT EXISTS ( SELECT  *\n                FROM    sys.schemas\n                WHERE   name = 'miPINS' )\n    EXEC('CREATE SCHEMA [miPINS]');\nGO\n\n-- CREATE VIEW FOR fact_absence_all--\n\nCREATE OR ALTER VIEW miPINS.vw_fact_absence_all\nAS\n\nSELECT DISTINCT\n\n    T1.AbsenceStartDate,\n    T1.AbsenceEndDate,\n    T1.Hours AS AbsenceHours,\n    T1.EmployeeID AS StaffNumber,\n    T6.WorkScheduleRule,\n    T1.AbsenceType,\n    T1.SicknessGroup,\n    CASE \n        WHEN AbsenceType = 'Sickness' THEN 'Sickness'\n        WHEN AbsenceType LIKE '%Annual%' THEN 'Annual'\n        ElSE '0'\n    END AS AbsenceGroup,\n    T1.Hours/T6.WorkDayHours AS Leave,\n\tcase datepart(dw,AbsenceStartDate)\n\t\twhen 2 then T6.WorkDayHours/7.4\n\t\twhen 3 then T6.WorkDayHours/7.4\n\t\twhen 4 then T6.WorkDayHours/7.4\n\t\twhen 5 then T6.WorkDayHours/7.4\n\t\twhen 6 then T6.WorkDayHours/7.4\n\t\telse null\n\tend as LeaveONS,\n    T6.WorkDayHours,\n    T5.Description PayBand,\n    T3.Description AS PersonnelArea,\n    T4.Description AS PersonnelSubArea,\n    T1.[AbsenceID] AS SicknessID,\n\tT1.[Days] as SicknessLength,\n    CASE \n        WHEN CAST([Days] AS FLOAT) > 20.0 then 'long-term'\n\t\tELSE 'short-term'\n    END AS SicknessLengthType\n\nFROM [odw_harmonised_db].[dbo].[hr_absence_dim] T1\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_record_fact] T2 ON T1.EmployeeID=T2.EmployeeID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_personnel_area_dim] T3 ON T3.PersonnelAreaID=T2.PersonnelAreaID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_personnel_sub_area_dim] T4 ON T4.PersonnelSubAreaID=T2.PersonnelSubAreaID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_payband_dim] T5 ON T5.PayBandID=T2.PayBandID\nLEFT JOIN [odw_harmonised_db].[dbo].[hr_work_schedule_dim] T6 ON T6.WorkScheduleID = T2.WorkScheduleID\n\nGO\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "odw_curated_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}