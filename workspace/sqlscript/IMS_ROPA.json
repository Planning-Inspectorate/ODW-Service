{
	"name": "IMS_ROPA",
	"properties": {
		"description": "Curated table for IMS_Ropa data for PBI reports",
		"folder": {
			"name": "IMS"
		},
		"content": {
			"query": " IF NOT EXISTS ( SELECT  *\n                 FROM    sys.schemas\n                 WHERE   name = 'miPINS' )\n     EXEC('CREATE SCHEMA [miPINS]');\n GO\n\n--CREATE VIEW FOR IMS ROPA--\n\n CREATE OR ALTER VIEW miPINS.vw_mipins_IMS_ROPA\n AS\n\n\nSELECT \n\tROPAID                                                                                          AS [ropa_id],\n    ROPAName                                                                                        AS [ropa_name],\n    ROPAType                                                                                        AS [type],\n    ROPAStatus                                                                                      AS [status],\n    ROPAPriority                                                                                    AS [priority],\n    REPLACE(ROPAOrganisationAreas, '^', '')                                                         AS [organisation_areas_c],\n    REPLACE(ROPADataControllers, '^', '')                                                           AS [data_controllers_c],\n    ROPAJointController                                                                             AS [joint_controller_c],\n    ROPACategoriesPersonalData                                                                    AS [categories_of_personal_data_c],\n    ROPACategoriesRecipients                                                                      AS [categories_of_recipients_c],\n    ROPASecurityMeasures                                                                            AS [security_measures_c],\n\n    CASE REPLACE(ThirdCountryNames, '^', '') \n        WHEN '' THEN NULL \n        ELSE REPLACE(ThirdCountryNames, '^', '') \n    END                                                                                             AS [third_country_names_c],\n\n    ThirdCountrySafeguards                                                                          AS [third_country_safeguards_c],\n    ROPALegitimateInterest                                                                          AS [legitimate_interest_c],\n    ISNULL(ROPAAutomatedDecisionMaking, '')                                                         AS [automated_decision_making_c], \n    ROPADataSource                                                                                  AS [data_source_c],\n    ROPARecordsOfConsent                                                                            AS [records_of_consent_c],\n    ROPADataLocation                                                                                AS [location_of_data_c],\n    ISNULL(DPIARequired, '')                                                                        AS [dpia_required_c],\n    ISNULL(DPIAStatus,'')                                                                           AS [dpia_status_c],\n    ROPARetentionPolicy                                                                             AS [retention_policy_c],\n    ISNULL(ROPARetentionPolicyApplied, '')                                                          AS [retention_policy_applied_c],\n    ROPADataBreachRecord                                                                            AS [data_breach_record_c],\n    ROPARetentionNotAdhered                                                                         AS [retention_not_adhered_c],\n    ROPAPrivacyNote                                                                                 AS [privacy_notice_c],\n\n\tCASE REPLACE(ROPACategoriesIndividualsTemp, '^', '') \n        WHEN '' THEN NULL \n        ELSE REPLACE(ROPACategoriesIndividualsTemp, '^', '') \n    END                                                                                             AS [categories_of_individuals_c],\n\n    ROPARetentionSchedule                                                                           AS [retention_schedule],\n    ISNULL(ROPABusinessFunction,'')                                                                 AS business_function,\n    ROPADPO                                                                                         AS [dpo],\n    ISNULL(ROPADataBreachOcurred,'')                                                                AS [data_breach_occurred_c],\n    ROPALastCurrentAccurateData                                                                     AS [last_current_and_accurate_da_c],\n\n\tCASE GDPRLawfulBasis \n        WHEN '^^' THEN NULL \n        ELSE REPLACE(REPLACE(GDPRLawfulBasis, '^^', ','), '^', '') \n    END                                                                                             AS [gdpr_lawful_basis_ms_c],\n\n\tCASE GDPRSpecialCategoryConditions \n        WHEN '^^' THEN NULL \n        ELSE REPLACE(REPLACE(GDPRSpecialCategoryConditions, '^^', ','), '^', '') \n    END                                                                                             AS [gdpr_special_cat_condition_m_c],\n\n\tCASE DPA2018Schedule1Condition \n        WHEN '^^' THEN NULL \n        ELSE REPLACE(REPLACE(DPA2018Schedule1Condition, '^^', ','), '^', '') \n        END                                                                                         AS [dpa_2018_sch1_condition_ms_c],\n\n    BusinessFunctioinUnstructured                                                                   AS [business_function_unstructured],\n    BDCEntityTemp                                                                                   AS [bdc_entity_temp_c],\n    ROPACategoriesIndividualsTemp                                                                   AS [cat_of_individuals_temp_c],\n    DocumentsIMSROPA                                                                                AS [ims_ropa_documents],\n    EstimatedNumberOperator                                                                         AS [estimated_number_of_operator_c],\n    REPLACE(ROPAInformationOwner, '&#039;', '''')                                                   AS [information_owner_c],\n    REPLACE(ROPAInformationExpert, '&#039;', '''')                                                  AS information_expert_c,\n\tDateEntered                                                                                     AS [date_modified]\n  \nFROM [odw_harmonised_db].[dbo].[ims_ropa_dim]\nWHERE DateEntered IS NOT NULL\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "odw_curated_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}