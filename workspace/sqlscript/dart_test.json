{
	"name": "dart_test",
	"properties": {
		"folder": {
			"name": "DaRT"
		},
		"content": {
			"query": "/*\n\ntest script for the DaRT query.\n\nMost fields are defined but linked cases need to be added.\nThe source of linked cases can be seen below - child_cases and lead_cases\nso the work needed is to get those into the main query.\n\n*/\n\nWITH child_cases AS\n(\nSELECT DISTINCT\nAAD1.AppealRefNumber,\nAAD2.AppealRefNumber        AS LinkedApealRef\nFROM [odw_harmonised_db].[dbo].[casework_all_appeals_dim] AS AAD1\nJOIN [odw_harmonised_db].[dbo].[casework_all_appeals_dim] AS AAD2\nON aad2.LeadCase = aad1.AppealRefNumber\nWHERE AAD1.LinkedAppeal != 'Not Linked'\nAND AAD1.IsActive = 'Y'\nAND AAD2.IsActive = 'Y'\n),\n\nlead_cases AS\n(\nSELECT DISTINCT\nAAD1.AppealRefNumber,\nAAD2.AppealRefNumber        AS LinkedApealRef\nFROM [odw_harmonised_db].[dbo].[casework_all_appeals_dim] AS AAD1\nJOIN [odw_harmonised_db].[dbo].[casework_all_appeals_dim] AS AAD2\nON aad1.LeadCase = aad2.AppealRefNumber\nWHERE AAD1.LinkedAppeal != 'Not Linked'\nAND AAD1.IsActive = 'Y'\nAND AAD2.IsActive = 'Y'\n),\n\nother_fields AS\n(\nSELECT DISTINCT\n                    t1.CaseReference,\n                    t1.AppealRefNumber,\n                    -- t6.ApplicationType,\n                    -- t6.AppealTypeReason,\n                    -- t6.AppealTypeGroup,\n                    -- t6.AppealType,\n                    -- t12.ProcedureName,\n                    -- t1.validity,\n                    -- t5.ProcessingState,\n                    t6.LinkedAppeal,\n                    t6.LeadCase    \n                    -- t21.LastPublishedDate,\n                    -- t7.LPACode,\n                    -- t7.LPAName,\n                    -- t6.Jurisdiction,\n                    -- t5.DevelopmentOrAllegation,\n                    -- t5.CaseProcess,\n                    -- t6.DevelopmentType,\n                    -- t22.RelatedReferences,\n                    -- t5.AppealSourceIndicator,\n                    -- t5.Level,\n                    -- t8.SpecialismID,\n                    -- t8.Specialism,\n                    -- t9.SpecialCircumstance,\n                    -- t5.AppellantStatementSubmitted,\n                    -- -- t15.WelshLanguage,\n                    -- t5.ProcedureAppellant,\n                    -- t6.AppealRecDate,\n                    -- t6.AppealStartDate,\n                    -- t1.ValidTo,\n                    -- t10.ValidityStatusDate,\n                    -- t5.CallInDate,\n                    -- t5.TargetDate,\n                    -- t5.StatementsDue,\n                    -- t5.ThirdPartyRepsDue,\n                    -- t5.FinalCommentsDue,\n                    -- t5.StatementOfCommonGroundDue,\n                    -- t5.ProofsDue,\n                    -- t22.ConsentDate,\n                    -- t12.OwnershipPermission,\n                    -- t11.ModifyDate,\n                    -- t12.LpaDecisionDate,\n                    -- t13.OutcomePublicSafety,\n                    -- t13.AdvertDetailsID,\n                    -- t13.ReasonPublicSafety,\n                    -- t13.OutcomeAmenity,\n                    -- t13.ReasonAmenity,\n                    -- t13.IsActive as AdvertInPosition,\n                    -- t13.SignDescription as AdvertDescription,\n                    -- t5.LPAApplicationDate,\n                    -- t5.LPAApplicationReference,\n                    -- t23.Section,\n                    -- t14.ContactID,\n                    -- t14.Title,\n                    -- t14.Salutation,\n                    -- t14.FirstName,\n                    -- t14.LastName,\n                    -- t14.TypeOfInvolvement,\n                    -- -- t15.AddressLine1,\n                    -- -- t15.AddressLine2,\n                    -- -- t15.AddressTown,\n                    -- -- t15.PostCode,\n                    -- -- t15.Easting,\n                    -- -- t15.Northing,\n                    -- t5.InspectorNeedToEnterSite,\n                    -- t5.NumberOfResidences,\n                    -- t5.AreaOfSiteInHectares,\n                    -- t5.FloorSpaceInSquareMetres,\n                    -- t5.SiteGreenBelt,\n                    -- t5.HistoricBuildingGrantMade,\n                    -- t5.AgriculturalHolding,\n                    -- t16.GroundForAppeal,\n                    -- t16.GroundLetter,\n                    -- t16.GroundForAppealStartDate,\n                    -- t18.EventType,\n                    -- t18.StartDateOfEvent,\n                    -- t18.StartTimeOfEvent,\n                    -- t18.EndDateOfEvent,\n                    -- t18.DateEventRequested,\n                    -- t17.ChartStatus,\n                    -- t17.EstPrepTime,\n                    -- t17.EstSitTime,\n                    -- t17.EstRepTime,\n                    -- t17.ActualDuration,\n                    -- t19.NotificationOfSV\n\nFROM                odw_harmonised_db.dbo.casework_case_info_dim t1\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_all_appeals_additional_data_dim t5\nON                  t1.AppealRefNumber = t5.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t5.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_all_appeals_dim t6\nON                  t1.AppealRefNumber = t6.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t6.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_local_planning_authority_dim t7\nON                  t6.LPAID = t7.LPAID\nAND                 t6.IsActive = 'Y'\nAND                 t7.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_specialism_dim t8\nON                  t1.AppealRefNumber = t8.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t8.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_special_circumstance_dim t9\nON                  t1.AppealRefNumber = t9.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t9.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_case_dates_dim t10\nON                  t1.AppealRefNumber = t10.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t10.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_specialist_modifications_dim t11\nON                  t1.AppealRefNumber = t11.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t11.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_picaso_dim t12\nON                  t1.AppealRefNumber = t12.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t12.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_advert_details_dim t13\nON                  t1.AppealRefNumber = t13.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t13.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_contact_information_dim t14\nON                  t1.AppealRefNumber = t14.CaseNumber\nAND                 t1.IsActive = 'Y'\nAND                 t14.IsActive = 'Y'\n\n-- LEFT OUTER JOIN     odw_harmonised_db.dbo.casework_nsip_project_info_internal_dim t15\n-- ON                  t1.CaseReference = t15.CaseReference\n-- AND                 t1.IsActive = 'Y'\n-- AND                 t15.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_enforcement_grounds_dim t16\nON                  t1.AppealRefNumber = t16.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t16.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_event_dim t17\nON                  t1.AppealRefNumber = t17.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t17.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_event_fact t18\nON                  t17.EventID = t18.EventID\nAND                 t17.IsActive = 'Y'\nAND                 t18.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_specialist_environment_dim t19\nON                  t1.AppealRefNumber = t19.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t19.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_nsip_advice_dim t21 \nON                  t1.CaseReference = t21.CaseReference\nAND                 t1.IsActive = 'Y'\nAND                 t21.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.high_court_dim t22\nON                  t1.AppealRefNumber = t22.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t22.IsActive = 'Y'\n\nLEFT OUTER JOIN     odw_harmonised_db.dbo.casework_specialist_case_string_dim t23\nON                  t1.AppealRefNumber = t23.AppealRefNumber\nAND                 t1.IsActive = 'Y'\nAND                 t23.IsActive = 'Y'\n)\n\n-- SELECT top 1000 \n--     t1.AppealRefNumber, \n--     t1.LinkedAppeal,\n--     t1.LeadCase,\n--     t2.LinkedApealRef as child_cases\n-- from other_fields t1\n-- INNER JOIN child_cases t2\n-- on t1.AppealRefNumber = t2.AppealRefNumber\n-- order by 1, 2\n-- ;\n\nselect top 10 * from other_fields where LinkedAppeal != 'Lead'\n;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "odw_harmonised_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}