{
	"name": "setupPurviewPermissions",
	"properties": {
		"content": {
			"query": "USE MASTER\nBEGIN TRY\n    CREATE LOGIN [pins-pview] FROM EXTERNAL PROVIDER;\nEND TRY\nBEGIN CATCH\n    SELECT 'The login pins-pview already exists' AS Messages\nEND CATCH\n\nUSE ODW_CONFIG_DB\n\nIF NOT EXISTS \n    (SELECT name  \n     FROM sys.server_principals\n     WHERE name = 'pins-pview')\nBEGIN\n    CREATE USER [pins-pview] FOR LOGIN [pins-pview];\nEND\nALTER ROLE db_datareader ADD MEMBER [pins-pview];\n\nUSE ODW_CURATED_DB\n\nIF NOT EXISTS \n    (SELECT name  \n     FROM sys.server_principals\n     WHERE name = 'pins-pview')\nBEGIN\n    CREATE USER [pins-pview] FOR LOGIN [pins-pview];\nEND\nALTER ROLE db_datareader ADD MEMBER [pins-pview];\n\nUSE ODW_HARMONISED_DB\n\nIF NOT EXISTS \n    (SELECT name  \n     FROM sys.server_principals\n     WHERE name = 'pins-pview')\nBEGIN\n    CREATE USER [pins-pview] FOR LOGIN [pins-pview];\nEND\nALTER ROLE db_datareader ADD MEMBER [pins-pview];\n\nUSE ODW_STANDARDISED_DB\n\nIF NOT EXISTS \n    (SELECT name  \n     FROM sys.server_principals\n     WHERE name = 'pins-pview')\nBEGIN\n    CREATE USER [pins-pview] FOR LOGIN [pins-pview];\nEND\nALTER ROLE db_datareader ADD MEMBER [pins-pview];\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}