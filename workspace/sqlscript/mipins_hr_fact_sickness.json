{
	"name": "mipins_hr_fact_sickness",
	"properties": {
		"content": {
			"query": "\n-- IPORTANT INFO : Prior to running this notebook you should update the calendar_dim_plus table, \n-- to get the most up to date informations regarding the columns which use the date \n-- To run update the table jus run the Calendar notebook \n\n\nIF NOT EXISTS ( SELECT  *\n                FROM    sys.schemas\n                WHERE   name = 'mipins' )\n    EXEC('CREATE SCHEMA [mipins]');\nGO\n\n--CREATE VIEW FOR SICKNESS FACT--\n\nCREATE OR ALTER VIEW mipins.vw_mipins_hr_fact_sickness\nAS\n\nSELECT DISTINCT\n\nabs.EmployeeID AS StaffNumber,\ndate.FinancialYear AS MeasureYear,\nCOUNT(*) as SicknessCount\n\nFROM [odw_harmonised_db].[dbo].[hr_absence_dim] abs\nFULL JOIN [default].[dbo].[calendar_dim_plus] date on date.CalendarDate = abs.AbsenceEndDate\n-- WHERE FinancialYear in ('CalendarYear')\nGROUP BY EmployeeID\n      ,FinancialYear\n\n\nUNION\n\nSELECT DISTINCT\n\nabs.EmployeeID,\ndate.CalendarYear,\nCOUNT(*) as SicknessCount\n\n\nFROM [odw_harmonised_db].[dbo].[hr_absence_dim] abs\nFULL JOIN [default].[dbo].[calendar_dim_plus] date on date.CalendarDate = abs.AbsenceEndDate\n-- WHERE FinancialYear in ('CalendarYear','CalendarYear')\nGROUP BY EmployeeID\n      ,CalendarYear\n\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "odw_curated_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}