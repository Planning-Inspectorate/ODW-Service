{
	"name": "df_main_pipeline_logs",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_odw_main_pipeline_logging",
						"type": "DatasetReference"
					},
					"name": "QueryBuilderUsingParams",
					"description": "Building query using params"
				}
			],
			"sinks": [
				{
					"name": "SaveToDB",
					"description": "pipeline_logs table"
				}
			],
			"transformations": [],
			"scriptLines": [
				"parameters{",
				"     Stage as string,",
				"     PipelineName as string,",
				"     PipelineRunID as string,",
				"     StartTime as string,",
				"     EndTime as string,",
				"     Inserts as integer,",
				"     Updates as integer,",
				"     Deletes as integer,",
				"     ErrorMessage as string,",
				"     StatusMessage as string,",
				"     PipelineTriggerID as string,",
				"     PipelineTriggerName as string,",
				"     PipelineTriggerType as string,",
				"     PipelineTriggeredbyPipelineName as string,",
				"     PipelineTriggeredbyPipelineRunID as string,",
				"     PipelineExecutionTimeInSec as string,",
				"     ActivityType as string,",
				"     DurationSeconds as string,",
				"     LogId as integer",
				"}",
				"source(output(",
				"          LogId as integer,",
				"          Name as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: (concat(\"SELECT \",         \\n    \"(SELECT IFNULL(MAX(LogId), 0) FROM logging.pipeline_logs) + 1 AS LogId, '\",         \\n    $PipelineName, \"' AS PipelineName, '\",        \\n    $PipelineRunID, \"' AS PipelineRunID, '\",        \\n    $StartTime, \"' AS StartTime, '\",        \\n    $EndTime, \"' AS EndTime, '\",        \\n    $DurationSeconds, \"' AS DurationSeconds, \",        \\n    toString($Inserts), \" AS Inserts, \",        \\n    toString($Updates), \" AS Updates, \",        \\n    toString($Deletes), \" AS Deletes, '\",        \\n    $ErrorMessage, \"' AS ErrorMessage, '\",        \\n    $StatusMessage, \"' AS StatusMessage, '\",        \\n    $PipelineTriggerID, \"' AS PipelineTriggerID, '\",        \\n    $PipelineTriggerName, \"' AS PipelineTriggerName, '\",        \\n    $PipelineTriggerType, \"' AS PipelineTriggerType, '\",        \\n    $PipelineTriggeredbyPipelineName, \"' AS PipelineTriggeredbyPipelineName, '\",        \\n    $PipelineTriggeredbyPipelineRunID, \"' AS PipelineTriggeredbyPipelineRunID, '\",        \\n    $PipelineExecutionTimeInSec, \"' AS PipelineExecutionTimeInSec, '\",        \\n    $ActivityType, \"' AS ActivityType\",\\n    \"FROM logging.pipeline_logs\"    \\n)),",
				"     format: 'query') ~> QueryBuilderUsingParams",
				"QueryBuilderUsingParams sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'logging',",
				"     tableName: 'pipeline_logs') ~> SaveToDB"
			]
		}
	}
}