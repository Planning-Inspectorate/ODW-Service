name: Data Validation Test

# This is the nightly data validation pipeline against the test environment
# Runs the pln_master_test Synapse pipeline for end-to-end testing

# Automatically run against the main branch at a set time every day
trigger: none
pr: none
schedules:
- cron: '0 20 * * 1-5' # cron syntax defining a schedule. At 8pm every week day
  displayName: Daily main branch run against the test env
  branches:
    include:
    - main
  always: true
  batch: false

variables:
- name: env
  value: test
- name: variableGroupName
  ${{ if eq(variables.env, 'prod') }}:
    value: "Terraform Prod"
  ${{ elseif eq(variables.env, 'test') }}:
    value: "Terraform Test"
  ${{ elseif eq(variables.env, 'build') }}:
    value: "Terraform Build"
  ${{ else }}:
    value: "Terraform Dev"
- name: agentPool
  value: 'pins-agent-pool-odw-${{ variables.env }}-uks'
- name: azureSubscription
  value: 'pins-agent-pool-odw-${{ variables.env }}-uks'
- group: ${{ variables.variableGroupName }}

stages:
- template: stages/run-e2e-pipeline-stage.yaml
  parameters:
    agentPool: 'pins-agent-pool-odw-${{ variables.env }}-uks'
    env: ${{ variables.env }}
    pipelineName: 'pln_master_test'
