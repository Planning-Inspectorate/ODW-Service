parameters:
  - name: armServiceConnectionName
    type: string
  - name: env
    type: string

steps:
  - script: |
      set -x
      buildTimestamp=$(date '+%Y%m%d%H%M%S')
      echo "Building with timestamp $buildTimestamp"
      poetry build --config-settings local-version=$buildTimestamp

      export PATH="$PATH:/home/AzDevOps/.local/bin/"
      python3 $(Build.SourcesDirectory)/pipelines/scripts/deploy_odw_package.py -e ${{ parameters.env }} -wn "odw-1.0.0+$buildTimestamp-py3-none-any.whl"
    displayName: 'Build and Deploy ODW package'
    name: BuildODWPackage
