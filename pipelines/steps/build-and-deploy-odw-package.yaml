parameters:
  - name: armServiceConnectionName
    type: string
  - name: env
    type: string

steps:
  - script: |
      set -e
      # Fetch all previous commits. See https://git-scm.com/docs/shallow
      git fetch --depth=2147483647
      # Build id set to the most recent commit hash for the odw folder- this is used to work out if the package has already been uploaded to Synapse
      buildId=$(git rev-list -1 HEAD $(Build.SourcesDirectory)/odw/)
      echo "Building with timestamp $buildId"
      poetry build --config-settings local-version=$buildId

      export PYTHONPATH="${PYTHONPATH}:/./"
#      python3 $(Build.SourcesDirectory)/pipelines/scripts/deploy_odw_package.py -e ${{ parameters.env }} -wn "odw-1.0.0+$buildId-py3-none-any.whl"
    displayName: 'Build and Deploy ODW package'
    name: BuildODWPackage
