parameters:
  - name: armClientId
    type: string
  - name: armClientSecret
    type: string
  - name: armSubscriptionId
    type: string
  - name: armTenantId
    type: string
  - name: environment
    type: string
    default: dev

steps:
  - script: |
      echo "Initialising Terraform using state file ${{ parameters.environment }}.tfstate..."
      echo "##[command]terraform init -backend-config="key=${{ parameters.environment }}.tfstate" -input=false"
      terraform init \
        -backend-config="key=${{ parameters.environment }}.tfstate" \
        -input=false
    displayName: 'Terraform Init'
    workingDirectory: infrastructure
    env:
      ARM_CLIENT_ID: ${{ parameters.armClientId }}
      ARM_CLIENT_SECRET: ${{ parameters.armClientSecret }}
      ARM_SUBSCRIPTION_ID: ${{ parameters.armSubscriptionId }}
      ARM_TENANT_ID: ${{ parameters.armTenantId }}
